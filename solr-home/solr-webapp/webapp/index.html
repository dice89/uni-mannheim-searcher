<!DOCTYPE html>
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">
<link rel="shortcut icon" href="http://getbootstrap.com/assets/ico/favicon.ico">

<title>People Search - Uni Mannheim</title>

<!-- Bootstrap core CSS -->
<link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Custom styles for this template -->
<link href="jumbotron-narrow.css" rel="stylesheet">

<!-- Just for debugging purposes. Don't actually copy this line! -->
<!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">

    </style>

  </head>

  <body>

    <div class="container">

    <div class="jumbotron">
      <h1>Uni Mannheim People Search</h1>
      <p class="lead">Finding contact details with ease. Supports backward and wildcard search. </br>Give it a try and let us know what you think!</p>

      <div class="container">
        <div class="row">    
          <div class="col-xs-10 col-xs-offset-1">
            <div class="input-group">
              <div class="input-group-btn search-panel">
                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                  <span id="search_concept">Field Search</span> <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu">
                  <li><a href="#firstNames">First Name </a></li>
                  <li><a href="#lastName">Last Name </a></li>
                  <li><a href="#email">Email </a></li>
                  <li><a href="#phoneNumber">Phone </a></li>
                  <li><a href="#location_street">Location </a></li>
                  <li class="divider"></li>
                  <li><a href="#*">Anything</a></li>
                </ul>


              </div>
              <input type="hidden" name="search_param" value="*" id="search_param">         
              <input type="text" id="searchInput" class="form-control" name="q" placeholder="Enter search term ...">
              <span class="input-group-btn">
                <button id="btnSearch" class="btn btn-default" type="button"><span class="glyphicon glyphicon-search"></span></button>
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="results" class="row marketing">
    </div>

    <div id="feedback" style="display: none;">
      <div class="row search-result">
        <div class="col-xs-12 col-sm-12 col-md-12">
          <div class="well">
            <div class="row">
              <div class="col-md-offset-2 col-sm-12 col-md-10">
                <h3>How did you like the results? <a href="https://docs.google.com/forms/d/1lU5bZ6kt9P5dGZJLJ26Vtce6LFu8Ui_qFWjXIMJ9ytc/viewform" target="_blank">Help us with your feedback!</a></h3>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Large feedback modal -->
      <div class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content">
          <div class="modal-header">

             <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
              <h4 class="modal-title" id="myModalLabel">Feedback</h4>
            </div>
            <div class="modal-body">
              <iframe width="100%" src="https://docs.google.com/forms/d/1lU5bZ6kt9P5dGZJLJ26Vtce6LFu8Ui_qFWjXIMJ9ytc/viewform"></iframe>
            </div>
            <div class="modal-footer">
            <a class="btn btn-default" href="https://docs.google.com/forms/d/1lU5bZ6kt9P5dGZJLJ26Vtce6LFu8Ui_qFWjXIMJ9ytc/viewform">Open in extra tab</a>
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>


    <script id="person-template" type="text/x-handlebars-template">
      {{#docs}} 
      <div class="row search-result">
        <div class="col-xs-12 col-sm-12 col-md-12">
          <div class="well">
            <div class="row">
              <div class="col-sm-3 col-md-2">
                <img src="{{#if imageurl}}{{imageurl}}{{else}}http://hubcaresupport.co.uk/sites/default/files/Default_Profile.jpg{{/if}}" alt="picture" class="img-rounded img-responsive" />
              </div>
              <div class="col-sm-6 col-md-8">
                <h4>
                  {{label}}</h4>
                  <p>
                  {{#if email}}
                    <i class="glyphicon glyphicon-envelope"></i>{{email}}
                    <br />
                  {{/if}}
                  
                  {{#if phoneNumber}}
                    <i class="glyphicon glyphicon-earphone"></i></i>{{phoneNumber}}
                    <br />
                  {{/if}}
                    <i class="glyphicon glyphicon-map-marker"></i>{{location_room}} {{{location_street}}} {{location_zip}}
                    <br />

                    <small><cite title="Go to homepage"><a target="_blank" href="{{url}}">{{url}}</a></cite></small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        {{/docs}} 

      </script>


    </div> <!-- /container -->
    <div id="footer">
      <div class="container">
        <ul class="nav nav-pills">
          <li><a href="/solr/index.html">Home</a></li>
          <li><a href="/solr/about.html">About</a></li>
        </ul>
      </div>
    </div>

  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
  <script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/handlebars.js/2.0.0-alpha.4/handlebars.min.js"></script>

  <script type="text/javascript">

    $(document).ready(function(e){
      //Initialize dropdown
      $('.search-panel .dropdown-menu').find('a').click(function(e) {
        e.preventDefault();
        var param = $(this).attr("href").replace("#","");
        var concept = $(this).text();
        $('.search-panel span#search_concept').text(concept);
        $('.input-group #search_param').val(param);
      });

      //Setup templating
      var source = $("#person-template").html(); 
      var template = Handlebars.compile(source); 

      //Handle search
      $( "#btnSearch" ).click(function() {
        $('#results').empty();
        var field = $("#search_param").val();
        if (field == "*") field = ""
        	else field +=":";
        var query = "&q=" + field + $("#searchInput").val();

        // alert(query);

        //Do backend call
        $.ajax({                    
          url: '/solr/collection1/select/?indent=on&wt=json'+query,
          dataType: 'json',
          cache: false,
          async: true,
          success: function( data, status ){
            // alert(JSON.stringify(data));

            var persons = data.response;
            // alert(persons.docs.length);
            $('#results').append(template(persons));
            $("#feedback").show();
          },
        error: function(xhr, textStatus, err) { //odstampaj textStatus, err jbt
            // alert('ne radi');
            // alert(textStatus);
            alert(err);

            // alert("readyState: "+xhr.readyState+"\n xhrStatus: "+xhr.status);
            // alert("responseText: "+xhr.responseText);
          }
        }); 
      });

      $("#searchInput").keypress(function(e) {
          if(e.which == 13) {
              $( "#btnSearch" ).click();
          }
      });
      
    });
</script>


</body></html>